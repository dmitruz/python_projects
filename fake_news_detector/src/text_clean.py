
from __future__ import annotations

import re
from typing import Iterable, List, Sequence, Union, Optional

# Precompiled patterns (module-level so they compile once)
URL_RE = re.compile(r"https?://\S+")
EMAIL_RE = re.compile(r"\S+@\S+")
NON_ASCII_RE = re.compile(r"[^\x00-\x7F]+")
EXTRA_SPACE_RE = re.compile(r"\s+")

__all__ = [
    "clean_text",
    "clean_many",
]

def clean_text(
    text: Optional[str],
    *,
    lowercase: bool = True,
    remove_urls: bool = True,
    remove_emails: bool = True,
    remove_non_ascii: bool = True,
    collapse_whitespace: bool = True,
) -> str:
  
    if not isinstance(text, str):
        return ""

    s = text

    if lowercase:
        s = s.lower()
    if remove_urls:
        s = URL_RE.sub(" ", s)
    if remove_emails:
        s = EMAIL_RE.sub(" ", s)
    if remove_non_ascii:
        s = NON_ASCII_RE.sub(" ", s)
    if collapse_whitespace:
        s = EXTRA_SPACE_RE.sub(" ", s).strip()

    return s


def clean_many(
    texts: Sequence[Optional[str]],
    **kwargs,
) -> List[str]:
   
    return [clean_text(t, **kwargs) for t in texts]